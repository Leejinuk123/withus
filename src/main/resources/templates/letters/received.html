<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>ë°›ì€ í¸ì§€í•¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- âœ… iOS ì „ì²´í™”ë©´ ì›¹ì•± ì„¤ì • -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="WithUs">
  <!-- iOS í™ˆí™”ë©´ ì•„ì´ì½˜ -->
  <link rel="apple-touch-icon" sizes="192x192" href="/icons/withuslogo.png">

  <!-- ë¸Œë¼ìš°ì € íƒ­ ì•„ì´ì½˜ -->
  <link rel="icon" type="image/x-icon" href="/icons/favicon.ico">

  <style>
    body { font-family: sans-serif; padding: 20px; background: #fff8f0; }
    h2 { text-align: center; color: #333; }

    .error-box {
      background: #ffe4e4;
      color: #d9534f;
      border: 1px solid #f5c6cb;
      border-radius: 10px;
      padding: 10px 15px;
      margin-bottom: 20px;
      font-weight: bold;
      text-align: center;
      animation: fadeIn 0.4s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .letter-list { list-style: none; padding: 0; }
    .letter-item {
      background: white;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
      box-shadow: 0 0 5px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
    }

    .letter-item a {
      text-decoration: none;
      color: inherit;
    }

    .status {
      font-size: 14px;
      margin-bottom: 5px;
      color: #666;
    }

    .locked {
      color: #e67e88;
      font-weight: bold;
    }

    .read {
      opacity: 0.6;
    }

    .meta {
      font-size: 12px;
      color: #aaa;
      margin-top: 5px;
    }

    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fff0f5;
      border-top: 2px solid #ffc1cc;
      display: flex;
      justify-content: space-around;
      padding: 12px 0;
      z-index: 999;
      font-family: 'Helvetica', sans-serif;
    }

    .bottom-nav a {
      text-decoration: none;
      color: #cc5a71;
      font-size: 15px;
      font-weight: bold;
      padding: 6px 10px;
      border-radius: 10px;
      transition: background 0.3s, color 0.3s;
    }

    .bottom-nav a:hover {
      background: #ffe4ec;
      color: #e75480;
    }

    .bottom-nav a.active {
      background: #ffb6c1;
      color: white;
      box-shadow: 0 0 5px rgba(255, 182, 193, 0.6);
    }
  </style>
</head>
<body>
<h2>ğŸ“¬ ë°›ì€ í¸ì§€í•¨</h2>

<!-- ğŸ’¬ ì—ëŸ¬ ë©”ì‹œì§€ ë„ìš°ê¸° -->
<div th:if="${errorMessage}" class="error-box" th:text="${errorMessage}">ì—ëŸ¬ ë©”ì‹œì§€</div>

<ul class="letter-list">
  <li th:each="letter : ${receivedLetters}" class="letter-item">
    <a th:href="@{'/letters/view/' + ${letter.id}}">

      <!-- ğŸ”’ ì ê¸ˆ or ì½ìŒ ì—¬ë¶€ -->
      <div class="status">
        <span th:if="${letter.unlockDate != null and letter.unlockDate > T(java.time.LocalDateTime).now()}" class="locked">
          ğŸ”’ ì ê¸ˆ ì¤‘ (í•´ì œì¼: <span th:text="${#temporals.format(letter.unlockDate, 'yyyy.MM.dd HH:mm')}">0000.00.00</span>)
        </span>
        <span th:if="${letter.unlockDate == null or letter.unlockDate <= T(java.time.LocalDateTime).now()}">
          <span th:if="${letter.read}" class="read">âœ… ì½ìŒ</span>
          <span th:if="${!letter.read}">ğŸ“¬ ì•ˆ ì½ìŒ</span>
        </span>
      </div>

      <!-- ğŸ“ƒ ë‚´ìš© ìš”ì•½ (ì ê¸ˆ ìƒíƒœë©´ ìˆ¨ê¹€) -->
      <div th:if="${letter.unlockDate == null or letter.unlockDate <= T(java.time.LocalDateTime).now()}"
           th:text="${#strings.abbreviate(letter.content, 30)}"
           th:classappend="${letter.read} ? 'read' : ''">
        ë‚´ìš© ìš”ì•½
      </div>

      <!-- ğŸ” ì ê¸´ í¸ì§€ ë‚´ìš©ì€ ì•ˆ ë³´ì—¬ì£¼ê³  ì ê¸ˆ ì•ˆë‚´ -->
      <div class="locked" th:if="${letter.unlockDate != null and letter.unlockDate > T(java.time.LocalDateTime).now()}">
        (í¸ì§€ê°€ ì ê²¨ ìˆì–´ ë‚´ìš©ì„ ë³¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤)
      </div>

      <div class="meta" th:text="${#temporals.format(letter.createdAt, 'yyyy.MM.dd HH:mm')}">ì‘ì„± ì‹œê°„</div>
    </a>
  </li>
</ul>

<!-- âœ‰ï¸ ë°›ì€ í¸ì§€ê°€ ì—†ì„ ë•Œ ì•ˆë‚´ ë©”ì‹œì§€ -->
<div th:if="${#lists.isEmpty(receivedLetters)}" style="
     background: white;
     border-radius: 10px;
     padding: 20px;
     margin-top: 20px;
     text-align: center;
     box-shadow: 0 0 5px rgba(0,0,0,0.05);
     font-size: 16px;
     color: #999;">
  ì•„ì§ ë°›ì€ í¸ì§€ê°€ ì—†ì–´ìš” ğŸ’Œ
</div>

<nav class="bottom-nav">
  <a href="/" th:classappend="${currentURI == '/' ? 'active' : ''}">ğŸ  ë©”ì¸</a>
  <a href="/letters/received" th:classappend="${currentURI.startsWith('/letters/received') ? 'active' : ''}">ğŸ“¬ ë°›ì€ í¸ì§€í•¨</a>
  <a href="/letters/sent" th:classappend="${currentURI.startsWith('/letters/sent') ? 'active' : ''}">ğŸ“¤ ë³´ë‚¸ í¸ì§€í•¨</a>
  <a href="/letters/write" th:classappend="${currentURI.startsWith('/letters/write') ? 'active' : ''}">ğŸ’Œ í¸ì§€ ì“°ê¸°</a>
</nav>

</body>
</html>
